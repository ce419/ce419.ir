<!DOCTYPE html>
<html>
  <head>
    <title>برنامه‌نویسی وب: Python</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/css/slides.css" />
  </head>
  <body>
    <textarea id="source">

class: center, middle, inverse

# Scaling

---
class: center, middle, inverse

# High Scalibility

---
.left-column[
  ## مقیاس
]
.right-column[
* پاسخ‌گویی به حجم بالای کاربران نیازمند بستر سخت‌افزار بسیار قوی، معماری درست پروژه، و کد نوشته شده با ملاحظات مقیاس‌پذیری است.
* تعداد سرورهای فیسبوک
    * 10K در سال ۲۰۰۸
    * 30K در سال ۲۰۰۹
    * 60K در سال ۲۰۱۰
    * 200K در سال ۲۰۱۲
* گوگل
    * بیش از یک میلیون سرور
    * پانزده مرکز داده‌ای
    * سیستم‌های توزیع شده‌ی نرم‌افزاری
]
---
.left-column[
  ## مقیاس
]
.right-column.pic[
.center[![Google Data Centers](images/datacenter1.jpg)]
]
---
.left-column[
  ## مقیاس
]
.right-column.pic[
.center[![Google Data Centers](images/datacenter2.jpg)]
]
---
.left-column[
  ## مقیاس
]
.right-column[
* **تعداد کاربران:** کل کاربران/بازدیدکنندگان سایت
* **کاربران فعال ماهانه:** کاربرانی  که در یک ماه اخیر فعالیت داشتند
* **کاربران آنلاین:** کاربرانی که همزمان در حال استفاده از سایت هستند
* **درخواست بر ثانیه:** تعداد درخواست‌های همزمانی که در هر ثانیه به سرور می‌رسد
* **میانگین زمان پاسخ:** زمان میانگین برای پردازش یک درخواست
* **دهک‌های زمان پاسخ:** X درصد از درخواست‌ها در کمتر از T ثانیه پاسخ داده می‌شوند 
* **توان عملیاتی:** حداکثر تعداد پردازش درخواست در ثانیه
]
---
.left-column[
  ## مقیاس
]
.right-column[
* **تعداد کارگر:** پردازه‌های پاسخ‌دهنده به درخواست‌ها که کد سایت را اجرا می‌کنند
* **حافظه‌ی مورد نیاز هر کارگر:** حداکثر حافظه‌ی غیراشتراکی مورد نیاز توسط هر کارگر
* **سربار سیستم عامل:** منابع حداقلی مورد نیاز برای اجرای سیستم
* **منابع اصلی:** پردازنده، حافظه، هارد
* **صف پاسخ به درخواست:** برای نگهداری درخواست‌ها در وب سرور در زمان پر بودن تمام کارگرها
* **میانگین زمان پاسخ کارگر:** زمان صرف شده برای اجرای کد و پردازش‌های مرتبط با کد
* **تعداد اتصال همزمان:** مورد استفاده توسط وب سرور برای برقراری ارتباط TCP با کلاینت‌ها
]
---
.left-column[
  ## مقیاس
]
.right-column[
* بالا بردن مقیاس (scale): بالا بردن توان عملیاتی 
* **مقیاس‌پذیری عمودی:** بالا بردن مقیاس با اضافه کردن منابع ماشین‌های موجود
    * سادگی، بدون نیاز به تغییرات نرم‌افزاری
    * هزینه‌ی بالا، محدودیت در افزایش
* **مقیاس‌پذیری افقی:** بالا بردن مقیاس با اضافه کردن ماشین‌های جدید
    * هزینه پایین‌تر، عدم محدودیت در افزایش
    * نیاز به تغییرات نرم‌افزاری در سطح معماری و کد
* اهمیت زیاد امکان رشد خطی با رشد بار
]
---
class: center, middle, inverse

# Common Architectures

---
.left-column[
  ## مقیاس
  ## معماری
]
.right-column[
* شروع از ساده‌ترین ساختار
* بهینه‌سازی فقط با دلیل واقعی روی گلوگاه‌ها
* نیازمندی‌ها و شرایط عملیاتی معمولا پیچیده‌تر از آن هستند که بتوان از ابتدا درک درستی نسبت به آن‌ها داشت و معماری نهایی را از ابتدا تعیین کرد.
* کمی صرف هزینه‌ی بیشتر در ابتدای کار برای مشخص‌تر شدن حوزه و درگیر نشدن در مسائل مقیاس‌پذیری مفید است.

.center[![Single Server](images/single_server.png)]
]
---
.left-column[
  ## مقیاس
  ## معماری
]
.right-column[
* مقیاس افقی نیازمند به کارگیری مفاهیم نو و پیچیده‌تر نرم‌افزاری است.
* به خاطر جا افتاده بودن برخی از مفاهیم در پروتکل‌ها و توسعه‌ی وب، برخی از مقیاس‌های افقی بدون دردسر در دسترس هستند.
    * جدایی داده از کد با مفهوم پایگاه داده
    * مستقل بودن درخواست‌ها از هم به خاطر Stateless بودن پروتکل HTTP
* تکنولوژی‌های جدید:
    * نیازمند دانش بیشتر و آشنایی با کاربرد
    * نیازمند برخی تکنیک‌ها برای رفع نیازهای معمول
    * نیازمند پیاده‌سازی‌های مناسب و قوی
    * گزینه‌های مختلف برای هر کارکرد و شرایط معین
    * بالا رفتن کارایی و مقیاس‌پذیری در صورت استفاده‌ی درست در شرایط مناسب
]
---
.left-column[
  ## مقیاس
  ## معماری
]
.right-column[
* پایگاه داده در سرور مستقل:
.center[![Separate Database](images/separate_database.png)]

* چند وب سرور با استفاده از تقسیم کننده‌ی بار:

.picR[![Load Balancer](images/load_balancer.png)]
]
---
.left-column[
  ## مقیاس
  ## معماری
]
.right-column[
* جداسازی محتوای ایستا از پویا

.picR[![Http Accelarator](images/http_accelerator.png)]

* افزایش قابل توجه کارایی به دلیل نیازمندی کمتر سرو محتوای ایستا به منابع
* امکان Cache کردن محتواهای پویای کم تغییر
* آزاد شدن کارگرها برای پردازش‌های ضروری و نو
]
---
.left-column[
  ## مقیاس
  ## معماری
]
.right-column[
* امکان تعمیم DB به DB Cluster:
.center[![Separate Database](images/separate_database.png)]

* استفاده‌ی کمکی از DB Replication:

.picR[![Database Replication](images/database_replication.png)]
]
---
.left-column[
  ## مقیاس
  ## معماری
]
.right-column[
.picR[![Combined Setup](images/combined.png)]

سایر مثال‌ها:
[اینجا](https://upload.wikimedia.org/wikipedia/commons/5/51/Wikipedia_webrequest_flow_2015-10.png) و
[اینجا](https://upload.wikimedia.org/wikipedia/commons/d/d8/Wikimedia-servers-2010-12-28.svg)
]
---
.left-column[
  ## مقیاس
  ## معماری
]
.right-column[
* با توجه به نیازهای مختلف، تکنولوژی‌های مختلفی ایجاد شده‌اند که در معماری اپلیکیشن‌های نوین وب کاربرد دارند. مهم شناخت این اجزا و استفاده‌ی مناسب از هر کدام است.
* سرورهای Cache: مانند پایگاه داده، ولی برای ذخیره‌ی داده‌های Cache
    * مانند Memcached و Redis
* فایل سرورها: برای اشتراک‌گذاری فایل‌ها میان سرورهای بدون حالت
    * مانند پروتکل NFS
* صف‌های وظیفه و مصرف کننده‌ها: برای جداسازی اعمال زمان‌بر از چرخه‌ی اصلی پاسخ
    * مانند Celery و ZeroMQ و RabbitMQ
]
---
.left-column[
  ## مقیاس
  ## معماری
]
.right-column[
* تجمیع لاگ: برای نگهداری لاگ‌های وب و سرورها در یک محل با امکان جستجو و تجمیع
    * مانند LogStash و ElasticSearch و Kibana
* جستجو: برای نگهداری متون و شاخص‌گذاری آن‌ها برای جستجوی سریع
    * مانند ElasticSearch
* گره‌های امنیتی: برای حفظ امنیت و جلوگیری از نفوذ یا ایجاد اختلال
    * مانند فایروال‌ها، WAFها، Proxyها
* Service Discovery: برای اتصال اجزای مختلف به صورت انعطاف‌پذیر و قابل تغییر
]
---
class: center, middle, inverse

# High Availibility

---
.left-column[
  ## مقیاس
  ## معماری
  ## HA
]
.right-column[
* هدف، کسب درآمد است و کاربر منبع درآمد. باید بیشترین توجه به کاربر بشود تا بتوان از حداکثر اندازه‌ی بازار استفاده کرد و فرصت‌های ایجاد شده را تبدیل به پول کرد.
* هر 100ms تاخیر بیشتر می‌تواند باعث کاهش 1% فروش شود. تاثیرات قطعی کامل بسیار شدیدتر است.

.picR[![Page Load And Users](images/pageload11.jpg)]
]
---
.left-column[
  ## مقیاس
  ## معماری
  ## HA
]
.right-column[
* هر سیستم کامپیوتری در معرض مشکلات و باگ‌های بسیاری است. کارکرد درست بیشتر یک حالت خاص ایده‌آل است تا یک انتظار معقول.
* افزایش اجزا و تکنولوژی‌های مورد استفاده، یا اصطلاحا Moving Parts، صرفا باعث کاهش اتکاپذیری سیستم می‌شود نه افزایش آن.
    * در صورت وابسته بودن کارکرد کل سیستم به کارکرد تک‌تک اجزای آن، احتمال درستی کل سیستم برابر ضرب احتمال درستی هر یک از اجزا است.
* اقداماتی مستقل باید برای خود موضوع دسترسی‌پذیری کل سیستم از نظر کاربر صورت بگیرد.
* پایداری، مانایی و درستی داده‌ها هم اهمیت خاص خود را دارد.
]
---
.left-column[
  ## مقیاس
  ## معماری
  ## HA
]
.right-column[
* HA تلاش برای تبدیل ضرب‌ها به جمع در فرمول احتمال درستی سیستم است.
* احتمال درستی یک سیستم حداکثر به میزان حداقل احتمال درستی اجزای آن است.
    * انتقال اجزای ناپایدارتر به خارج از زنجیره‌ی اصلی
    * استفاده از اجزای با پایداری بالا به عنوان رابط سایر اجزا
    
.picR[![Load Balancer](images/load_balancer.png)]
]
---
.left-column[
  ## مقیاس
  ## معماری
  ## HA
]
.right-column[
* استفاده از تکنیک‌های متدوال و توصیه شده به HA کمک می‌کند.
    * جدا کردن اجزای ایستا، Caching، جدا کردن وظیفه‌های سنگین
* پس از اقدامات اولیه، اولین گام، استفاده از سرور تقسیم بار LB روبروی سرورهای اپلیکیشن است.
    * مثلا با استفاده از HAProxy.
* با داشتن چند LB و اختصاص یک IP به تمام آن‌ها، می‌توان حالات مشکل در یکی از آن‌ها را نیز تحمل کرد.
    * روش پیشرفته‌تر به صورت L4/L7 است.
* برای تحمل مشکلاتی به بزرگی یک دیتاسنتر، از چندین دیتاسنتر در نقاط مختلف و تقسیم ترافیک میان آن‌ها با مکانیزم‌های جغرافیایی DNS استفاده می‌شود.
]
---
class: center, middle, inverse

# Cloud

---
.left-column[
  ## مقیاس
  ## معماری
  ## HA
  ## ابر
]
.right-column[
* اختصاص ظرفیت به صورت بهینه مهم‌ترین مشکل در بسیاری از سازمان‌ها است.
* با افزایش تکنولوژی‌ها، سطح مهارت و توان لازم برای نگهداری یک سیستم خوب بسیار بالا رفته است.
* نیاز به استفاده‌ی بهینه، ساده و ارزان از نوین‌ترین و بهترین تکنولوژی‌های موجود به صورتی که تضمین‌های کیفی لازم را نیز به همراه داشته باشد، به پیدایش مفهوم ابر و سرویس‌های ابری انجامیده است.
]
---
# پِی مطالب رو بگیرید:
.en.small[
* [Google Data Centers](https://www.google.com/about/datacenters/inside/locations/index.html)
* [Web Application Scaling](https://www.digitalocean.com/community/tutorials/5-common-server-setups-for-your-web-application)
* [L4/L7 In GitHub's GLB](https://githubengineering.com/introducing-glb/)
]
    </textarea>
    <script src="/js/remark-latest.min.js"></script>
    <script src="/js/slides.js"></script>
  </body>
</html>
