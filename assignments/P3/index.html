<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>برنامه‌نویسی وب: CE419</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- CSS
================================================== -->
<link rel="stylesheet" href="/css/bootstrap.css">
<link rel="stylesheet" href="/css/bootstrap-responsive.css">
<link rel="stylesheet" href="/css/flexslider.css" />
<link rel="stylesheet" href="/css/custom-styles.css">
<style>
  body { direction: rtl; }
  p, li { line-height: 1.9; text-align: justify; }
  ul {margin-right: 50px; }
</style>

<!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <link rel="stylesheet" href="/css/style-ie.css"/>
<![endif]--> 

<!-- Favicons
================================================== -->
<link rel="shortcut icon" href="/img/favicon.ico">
<link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="72x72" href="/img/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="114x114" href="/img/apple-touch-icon-114x114.png">

<!-- JS
================================================== -->
<script src="/lib/jquery/dist/jquery.min.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/jquery.flexslider.js"></script>
<script src="/js/jquery.custom.js"></script>
</head>

<body>
	<div class="color-bar-1"></div>
    <div class="color-bar-2 color-bg"></div>
    
    <div class="container main-container">
    <div class="row">
        <div class="span12" style="margin-top: 20px;">
            <h2>پروژه نهایی</h2>
            <p class="lead">
            جنگو؛ فاز‌های سه و چهار پروژه
            </p>
            <br/>
            <p>
هدف از این فاز، تکمیل سامانه وبلاگ‌ساز است. ابتدا، در گام اول، با استفاده از جنگو APIیی مشابه API استفاده شده در فاز دوم ایجاد خواهیم کرد و در ادمین جنگو امکان ویرایش و مدیریت محتوای آن را ایجاد خواهیم کرد. سپس در گام دوم، به افزودن امکانات جدیدی به وبلاگ خواهیم پرداخت. در گام سوم نیز اقدام به استقرار کدهای نوشته شده خواهیم پرداخت.
            </p>
            </br>

            <h3 class="title-bg">کارکرد اصلی سامانه</h3>
            <div class="row">
                <div class="span12">
                <p>
سامانه وبلاگ‌ساز امکان ایجاد و مدیریت تعداد دلخواهی وبلاگ را به کاربران خود می‌دهد. هر کاربر می‌تواند پس از ثبت‌نام در سامانه، وارد سامانه شود و برای خود وبلاگ ایجاد نماید. هر وبلاگ شامل تعدادی پست می‌باشد و بازدیدکنندگان می‌توانند روی پست‌ها کامنت بگذارند.
                </p>
                </div>
            </div>
            
            <h3 class="title-bg">گام یک</h3>
            <div class="row">
                <div class="span12">
                <p>
ابتدا می‌خواهیم دقیقا مشابه API استفاده شده در فاز دو را ایجاد نماییم تا بتوانیم کدهای UI فاز دو را مستقیما به آن متصل کنیم. امکانات اصلی API، ثبت‌نام، دریافت لیست پست‌ها و کامنت‌ها، و امکان ایجاد کامنت و نظر می‌باشد.
</p><p>
برای شروع، یک پروژه جنگو ایجاد نمایید و اپ‌های لازم را در آن ایجاد نمایید. ایجاد حداقل دو اپ، یکی برای مدیریت کاربران و یکی برای مدیریت وبلاگ‌ها پیشنهاد می‌شود. سپس بر اساس خروجی‌های API، مدل‌ها (جدول‌های پایگاه داده) را طراحی کنید و مهاجرت‌های مربوطه را ایجاد کنید.
 </p><p>
پس از ایجاد مدل‌ها، ادمین را برای مدل‌ها فعال نمایید. حتما از امکانات نمایش لیستی، جستجو، فیلتر و نمایش دسته‌بندی شده‌ی فیلدها در زمان ویرایش برای بهبود رابط کاربر ادمین استفاده کنید. برای اطمینان از درستی طراحی مدل‌ها، از هر مدل چند شی در ادمین ایجاد نمایید و دقت کنید که در صورت کم بودن فیلدی یا نامناسب بودن نوع ارتباط مدل‌ها، آن‌ها را اصلاح نمایید.
 </p><p>
با نهایی شدن دیتا مدل، به پیاده‌سازی APIهای فاز دو بپردازید. در این گام آدرس url مربوطه و نوع ورودی‌ها و خروجی‌ها تا جای ممکن مشابه فاز دو باشد. یک تغییر مورد نیاز، حذف پارامتر studentid از لاگین و ثبت نام است؛ چرا که تنها خودتان به API متصل خواهید شد. تغییر عمده‌ی دیگر، اضافه کردن شماره وبلاگ به urlها است چرا که سامانه وبلاگ‌ساز امکان پشتیبانی از چندین وبلاگ را دارد ولی کد UI نوشته شده تنها اطلاعات مربوط به یک وبلاگ را مدیریت می‌کند.
</p><p>
برای حل این مشکل، یک API مانند /auth/blog-id ایجاد کنید که شناسه وبلاگ پیش‌فرض کاربر لاگین شده‌ی فعلی را برگرداند. برای نگهداری وبلاگ پیش‌فرض هر کاربر، باید تغییرات لازم را در مدل‌ها ایجاد کنید و همچنین به صورت خودکار اولین وبلاگ هر کاربر، وبلاگ پیش‌فرض او باشد. سپس مثلا برای دریافت پست‌های وبلاگ، از آدرس /blog/ID/posts استفاده کنید که ID شناسه وبلاگ برگردانده از فراخوانی API فوق است.
 </p><p>
در نهایت با اجرای سرور پروژه و سرور کد فاز دوم پروژه خود، اطمینان حاصل کنید که رابط کاربری قبلی به صورت کامل و درست با API کار می‌کند. در صورت نیاز تغییرات لازم را در فاز قبلی نیز ایجاد و کامیت نمایید.
                </p>
                </div>
                <br/>
                <h3>نکات پیاده‌سازی</h3>
                <div class="span12">
                <ul>
                <li>
برای راه‌اندازی پایتون و جنگو، از پایتون ۳ و جنگو 1.11 استفاده نمایید. حتما برای مدیریت پیش‌نیازها از virtualenv و pip برای نصب بسته‌ها استفاده کنید. استفاده از محیط‌های آماده‌ی پایتون مانند Anaconda مجاز نمی‌باشد (برای یادگیری بهتر، نه بد بودن این محیط‌ها). در صورت استفاده از ویندوز، پیشنهاد می‌شود که از پایتون 3.5 استفاده کنید (چرا که در حال حاضر بسته‌های کامپایل شده‌ی بیشتری برای آن وجود دارد) و در صورت استفاده از Mac یا Linux، از پایتون 3.6 یا پایتون پیش‌فرض سیستم عامل استفاده نمایید.
                </li>
                <li>
برای نگهداری اطلاعات کاربران، مثلا وبلاگ پیش‌فرض، تصویر پروفایل یا هر موردی که در این گام یا گام دو ممکن است مورد نیاز باشد، باید از یک مدل سفارشی شده برای ذخیره اطلاعات کاربر استفاده کنید.
                </li>
                <li>
استفاده‌ی مناسب از امکانات ادمین جنگو برای تسهیل ورود و ویرایش اطلاعات، ضروری است. در صورت افزودن امکاناتی مانند پلاگین‌های ادمین، سفارشی کردن ظاهر ادمین، استفاده از ویجت‌های مناسب و … نمره‌ی بیشتری تعلق خواهد گرفت.
                </li>
                <li>
کدهای API پیاده‌سازی شده باید اعتبارسنجی کاملی را روی ورودی‌ها انجام دهند و در صورت نامعتبر بودن یک یا چند یک از ورودی‌ها، پیام خطای مناسبی برگردانند. برای انجام این اعتبارسنجی حتما از امکان فرم‌ها در جنگو استفاده شود. حالت‌های خاصی که مبتنی بر منطق سامانه می‌باشند، مثلا تکراری بودن نام کاربری،  باید در تابع‌های clean نوشته شوند.

                </li>
                <li>
برای تست سامانه، تعدادی کاربر و وبلاگ و پست و نظر را به صورت fixutre در اپ‌های مربوطه ایجاد کنید که در زمان تحویل قابل مشاهده و لود شدن باشد.
                </li>
                <li>
ار نظر کارایی، هیچ یک از APIها نباید به میزان (O(N عدد Query به پایگاه داده بزنند. مثلا تعداد Queryها برای برگرداندن کل پست‌های یک وبلاگ، باید عددی ثابت (منطقا زیر ده) و مستقل از تعداد پست‌های موجود باشد.
                </li>
                <li>
از پایگاه داده sqlite برای ذخیره‌سازی اطلاعات استفاده نمایید.
                </li>
                </ul>
                </div>
            </div>
            
            <h3 class="title-bg">گام دو</h3>
            <div class="row">
                <div class="span12">
                <p>
با تکمیل شدن API، در این گام می‌خواهیم امکانات جدیدی را به سامانه وبلاگ‌ساز اضافه کنیم. در این  گام تمرکز روی توسعه‌ی پایتون و جنگو است و دیگر نیازی به ایجاد تغییر در کد UI فاز دو نمی‌باشد. با این حال باید Backward Compatibiliy در APIهای توسعه داده شده تا اینجا رعایت شود و همان طور که در انتهای گام دو توضیح داده شد، باید کد UI فاز قبل کماکان درست کار کند.
                </p>
                <p>
می‌خواهیم امکان جستجو برای یافتن وبلاگ‌ها را به سیستم مدیریت وبلاگ خود اضافه کنیم. به این صورت که بازدیدکنندگان سامانه بتوانند یک عبارت را وارد کرده، و وبلاگ‌هایی را مشاهده کنند که در مورد آن عبارت در پست‌هایشان صحبت کرده‌اند. تکنولوژی‌های مختلفی مانند Elasticsearch برای پیاده‌سازی جستجو وجود دارد که انجام جستجو را بسیار آسان می‌کند، ولی جهت آشنایی با مفاهیم صف وظیفه، ما آن را بدون استفاده از این تکنولوژی‌ها و به صورت یک وظیفه‌ی غیرهمزمان پیاده‌سازی می‌کنیم.
                </p><p>
برای شروع، یک صفحه با آدرس search/blog ایجاد کنید. با مشاهده‌ی این صفحه، کاربر یک کادر جستجو مشاهده می‌کند. کادر جستجو با استفاده از یک فرم ساده‌ی جنگو پیاده‌سازی و اعتبارسنجی می‌شود. کاربر می‌تواند در این کادر تعدادی کلمه (حداقل دو و حداکثر ده کلمه‌ی فارسی) وارد کند و دکمه‌ی جستجو را بزند. با این کار، فرم به روش POST ارسال شده و در صورت معتبرنبودن، مثلا فارسی نبودن کلمات یا تعداد نامناسب آن‌ها، پیام خطای مربوطه به او نمایش داده خواهد شد. در صورت درست بودن، جستجو در میان وبلاگ‌ها صورت گرفته و لیستی از وبلاگ‌های یافته شده، همانند نتایج گوگل برای کاربر نمایش داده می‌شود. لازم به توضیح است که رابط کاربری این صفحه به صورت غیر AJAX و با استفاده از امکانات view و template جنگو پیاده‌سازی می‌شود. همچنین نیازی به طراحی گرافیکی خاصی برای صفحه نیست و صرفا ظاهری مرتب و ساده برای آن کافی است.
                </p><p>
برای پیاده‌سازی عملکرد جستجو، یک فیلد به هر وبلاگ اضافه می‌کنیم که شامل تمام کلمات به کار رفته در پست‌های آن وبلاگ باشد. یک فیلد جدید با نام posts_words از نوع رشته‌ای و با مقدار پیش‌فرض رشته‌ی خالی به مدل وبلاگ اضافه کنید و مهاجرت مربوط به اضافه شدن این فیلد را تعریف کنید. با اجرای این مهاجرت، فیلد مربوطه برای تمام وبلاگ‌ها ساخته می‌شود ولی خالی است. برای پر کردن این فیلد برای تمام وبلاگ‌های موجود، ابتدا یک تابع در مدل وبلاگ پیاده‌سازی کنید که با بررسی تمام پست‌های یک وبلاگ، کل کلمات به کار رفته در آن پست‌ها را شناسایی کرده و با فرمتی مشابه فرمت زیر، در فیلد posts_words ذخیره کند. سپس یک مهاجرت داده‌ای ایجاد کنید که این تابع را برای تمامی وبلاگ‌های موجود اجرا کند.
                </p><p><pre>word1-3,word2-4,word3-1,word4-2</pre></p><p>
تا اینجا مقدار فیلد posts_words برای وبلاگ‌های موجود محاسبه شد. می‌خواهیم با هر بار اضافه شدن یک پست، این فیلد برای وبلاگ مربوطه به روز شود. به دلیل زمان‌بر بودن، این محاسبه‌ی مجدد را به صورت یک وظیفه در Celery پیاده‌سازی می‌کنیم. به این صورت که پس از اضافه کردن Celery و انجام تنظیمات لازم در پروژه، یک تابع وظیفه ایجاد می‌کنیم که با گرفتن شناسه وبلاگ، کلمات پست‌های آن وبلاگ را مجددا محاسبه و در فیلد posts_words ذخیره‌سازی کند (عملا کافی است همان تابع پیاده‌سازی شده در این وظیفه برای وبلاگ داده شده فراخوانی شود). سپس با استفاده از امکان سیگنال‌ها در جنگو، در هر بار اضافه شدن یک پست، این تابع وظیفه را برای وبلاگ مربوطه فراخوانی کنید (به صورت غیرهمزمان، یعنی در صف وظیفه‌ها قرار دهید).
                </p><p>
در نهایت با پیاده‌سازی منطق جستجوی ذکر شده در صفحه‌ی search/blog کار را تکمیل می‌کنید. الگوریتم جستجو به این صورت عمل می‌کند که کلمات داده شده را در فیلد posts_words هر وبلاگ می‌شمارد و تعداد کلمات مشترک را، با لحاظ درصدی افزایش برای کلمات پرتکرارتر در متن، به عنوان امتیاز آن وبلاگ در نظر می‌گیرد و ده وبلاگ با بیشترین امتیاز را به ترتیب امتیاز و با نمایش امتیاز مربوطه، در نتایج به کاربر نمایش می‌دهد.
                </p>
                </div>
            </div>
            
            <h3 class="title-bg">گام سه</h3>
            <div class="row">
                <div class="span12">
                <p>
در این گام می‌خواهیم که کدهای نوشته شده را روی سرویس‌های ابری (مثلا PAASها) مستقر کنیم. لازم به توضیح است که تحویل دادنی پروژه ماند فازهای قبل، کدهای کامیت شده به صورت درست و در بازه‌های منظم روی GitHub و کد اجرایی مستقر شده روی سرویس‌های عمومی و قابل فراخوانی می‌باشد.
                </p>
                <p>
برای استقرار جنگو و انجام ملحقات این گام نیاز به یک دیتابیس PostgreSQL، یک دیتابیس Key-Value مانند Redis و یک وب‌سرور مانند Nginx و استفاده از gunicorn داریم.
برای استقرار کد جنگو روش‌های مختلفی وجود دارد که آسان‌ترین آن استفاده از Heroku به عنوان بستری ابری است. راه دیگر می‌تواند استفاده از سایر سرویس‌های ابری از جمله openshift باشد. هم‌چنین گرفتن یک VPS لینوکس و نصب برنامه‌های لازم و تنظیمات آن و اتصال آن‌ها به یکدیگر راه‌حل جایگزین دیگری است که انتخاب یکی از آن‌ها و استفاده از آن به عهده شما می‌باشد.
                </p><p> 
در نهایت باید وب‌سایت شما روی یک دامنه قابل دسترسی باشد و به یک دیتابیس متصل باشد و محاسبه‌ی مجدد کلمات وبلاگ‌ها را به صورت یک وظیفه‌ی جدا و غیرهمزمان انجام دهد. هم‌چنین پروژه در حالت غیر دیباگ (DEBUG=False) اجرا شده باشد اما مشکلات و خطاهای سروری لاگ شوند و شناسایی شوند. برای این کار باید از یکی از سیستم‌های جمع آوری خطا و مانیتورینگ Sentry یا Opbeat استفاده کرده باشد.
                </p><p>
برای ایجاد مخزن مربوط به این فاز، از این لینک استفاده نمایید. پس از اتمام پروژه، توضیحات مربوط به استقرار کد، شامل این توضیحات که بعد از هر بار به روزرسانی کد باید چه عملیاتی انجام شود تا سرور به روز شود، را در فایل UP.md قرار دهید و آدرس دامنه‌ی سایت مستقر شده را در readme مخزن قرار دهید.
                </p>
                </div>
            </div>
            
            <h3 class="title-bg">نکات تحویل</h3>
            <div class="row">
                <div class="span12">
                <ul>
                    <li>
هرگونه ابهام و سوال در مورد پروژه را در پیاتزا مطرح کنید.
                    </li>
                    <li>
مهلت ارسال هر سه گام پروژه تا ساعت ۲۲ روز ۲۳م تیرماه می‌باشد. به علت مهلت ارسال نمرات، این مهلت به هیچ عنوان قابل تمدید نمی‌باشد.
                    </li>
                    <li>
زمان تحویل حضوری پروژه روزهای ۲۴م و ۲۵م تیرماه می‌باشد. در صورت تمایل به استفاده از دو روز تاخیر در ارسال (در صورت باقی ماندن از فازهای قبل)، مهلت ارسال تا زمان مشخص شده برای تحویل حضوری شما خواهد بود.
                    </li>
                    <li>
گام یک در واقع فاز سه و گام دو و سه فاز چهار پروژه‌ی درس خواهد بود. برای تنظیم بهتر زمان و ملاحظه‌ی زمان مختلف امتحانات شما، مهلت تعیین کل گام‌ها همان روز ۲۳م تعیین شده است.
                    </li>
                    <li>
حجم کاری این فاز زیاد می‌باشد، و توانایی انجام آن در مدت محدود بخشی از هدف تمرین می‌باشد.
                    </li>
                    <li>
استفاده از کتابخانه‌های کمکی، تنها با هماهنگی در پیاتزا مجاز می‌باشد.
                    </li>
                </ul>
                </div>
            </div>
        </div>
    </div>
    
    </div>
    
    <div id="toTop" class="hidden-phone hidden-tablet">Back to Top</div>
</body>
</html>
